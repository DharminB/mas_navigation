<?xml version="1.0"?>
<!-- Note: this is a launch file to tune this component for different tasks. -->
<launch>
    <group ns="guarded_motion">
        <node pkg="mcr_geometric_relation_monitors" type="component_wise_pose_error_monitor_node"
                name="pose_error_monitor" output="screen">

            <remap from="~pose_error" to="/guarded_approach_pose/twist_controller/pose_error" />
        <remap from="~event_in" to="/event_in" />

            <!-- the cycle rate of the node (in Hz) -->
            <param name="loop_rate" type="double" value="20" />

            <!--todo: check if also for the other dimensions is required...-->
            <!-- the threshold for detecting if is within tolerance (in meters) -->
            <param name="threshold_linear_x" type="double" value="0.005" />
            <param name="threshold_linear_y" type="double" value="0.005" />
        </node>



    </group>

    <group ns="guarded_approach_pose">
        <node pkg="mcr_common_converters" type="transform_to_pose_converter_node"
                name="pose_converter" output="screen">

        <remap from="~event_in" to="/event_in" />

            <!-- the cycle rate of the node (in Hz) -->
            <param name="loop_rate" type="double" value="10"/>

            <param name="reference_frame" type="str" value="odom"/>
            <param name="target_frame" type="str" value="base_link"/>
        </node>

        <node pkg="mcr_manipulation_measurers" type="component_wise_pose_error_calculator_node"
                name="pose_error_calculator_trigger" output="screen">

        <remap from="~event_in" to="/event_in" />

            <!-- the cycle rate of the node (in Hz) -->
            <param name="loop_rate" type="double" value="20"/>

            <remap from="~pose_1"
                   to="/guarded_approach_pose/pose_converter/converted_pose"/>
            <remap from="~pose_2" to="/guarded_approach_pose/target_pose"/>
            <remap from="~pose_error"
                   to="/guarded_approach_pose/twist_controller/pose_error"/>
        </node>

        <node pkg="mcr_twist_controller" type="twist_controller_node"
                name="twist_controller" output="screen">

        <remap from="~event_in" to="/event_in" />

            <!-- the cycle rate of the node (in Hz) -->
            <param name="loop_rate" type="double" value="10"/>

            <!-- proportional gains for the Cartesian linear velocities-->
            <param name="p_gain_x" type="double" value="0.66"/>
            <param name="p_gain_y" type="double" value="0.66"/>
            <param name="p_gain_yaw" type="double" value="1.2"/>

            <remap from="~controlled_velocity"
                   to="/guarded_approach_pose/twist_limiter/twist"/>
        </node>

        <node pkg="mcr_twist_limiter" type="twist_limiter_node"
                name="twist_limiter" output="screen">

        <remap from="~event_in" to="/event_in" />
        <remap from="~limited_twist" to="/cmd_vel" />

            <!-- the cycle rate of the node (in Hz) -->
            <param name="loop_rate" type="double" value="10"/>

            <!-- Maximum linear velocities in the axes X, Y and Z (in meters/second) -->
            <param name="max_velocity_x" type="double" value="0.6"/>
            <param name="max_velocity_y" type="double" value="0.6"/>
            <param name="max_velocity_z" type="double" value="0.0"/>

            <!-- Maximum angular velocities around the axes X, Y and Z (in radians/second) -->
            <param name="max_velocity_roll" type="double" value="0.0"/>
            <param name="max_velocity_pitch" type="double" value="0.0"/>
            <param name="max_velocity_yaw" type="double" value="1.2"/>  
        </node>


        <!-- Helper GUI's -->
        <node pkg="mir_pregrasp_planner" type="pose_mock_up_gui_node"
                name="pose_mock_up_gui" output="screen">

        <remap from="~event_in" to="/event_in" />

            <!-- the cycle rate of the node (in hz) -->
            <param name="loop_rate" type="double" value="10"/>

            <!-- Reference frame of the published pose -->
            <param name="reference_frame" type="str" value="odom"/>

            <remap from="~mock_up_pose" to="/guarded_approach_pose/target_pose"/>
        </node>
    </group>
</launch>
